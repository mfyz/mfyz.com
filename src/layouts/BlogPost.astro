---
import type { CollectionEntry } from "astro:content";
import { format } from "date-fns";
import Tags from "@components/Tags";
import readingTime from "reading-time";
import CoverImage from "@components/CoverImage.astro";
import path from "path";

const { title, date, imageURL, tags, content, slug } = Astro.props;

const time = readingTime(content);

// Helper function to format date without timezone adjustments
function formatDatePreserveDay(dateStr) {
  // Handle cases where dateStr might not be a string
  if (!dateStr) return '';
  
  // Convert to string if it's a Date object
  const dateString = dateStr instanceof Date ? dateStr.toISOString() : String(dateStr);
  
  try {
    // Extract year, month, day directly from the string to avoid timezone issues
    const [year, month, day] = dateString.split('T')[0].split('-').map(num => parseInt(num, 10));
    // Format the date to "Feb 1, 2023" style
    return format(new Date(year, month - 1, day), "MMM d, yyyy");
  } catch (error) {
    console.error("Error formatting date:", dateString, error);
    return dateString; // Return original value if formatting fails
  }
}
---

<article class="mx-auto max-w-3xl">

  <div class="-mx-2 mb-8 overflow-hidden sm:-mx-4 md:-mx-6 lg:-mx-8">
    <CoverImage
      imageURL={imageURL}
      slug={slug}
      size="large"
      transition:name={slug}
    />
  </div>

  <h1>{title}</h1>

  <div class="mb-4 flex items-center justify-between text-gray-500 dark:text-gray-400">
    <time class="shrink-0">
      {formatDatePreserveDay(date)}
    </time>

    <div class="flex items-center gap-6">
      <span class="flex items-center gap-1">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path>
        </svg>

        {time.text}
      </span>
    </div>
  </div>

  <Tags list={tags} />

  <div class="mt-6"></div>
  <slot />
</article>
