---
import { Image } from "astro:assets";
import path from "path";

const { imageURL, slug, size = "thumbnail", index, className = "", type = "blog" } = Astro.props;

// Image size configuration with OG aspect ratio (1200:630 = 1.905)
const sizes = {
  large: { width: 1200, height: 630 },
  thumbnail: { width: 800, height: 420 },
  full: { width: 1200, height: 630 }
};

const { width, height } = sizes[size] || sizes["thumbnail"];

// If no imageURL provided, use OG image URL as fallback
const finalImageURL = imageURL || `${type === "blog" ? "" : `/${type}`}/${slug}/og.png`;
const extension = imageURL ? path.extname(imageURL) : "";
---

<style>
  .aspect-og {
    aspect-ratio: 1200 / 630;
  }
</style>

<div class={`relative inline-block w-full overflow-hidden rounded-md aspect-og ${className}`}>
  {extension.includes("webm") ? (
    <video
      src={finalImageURL}
      width={width}
      height={height}
      autoplay
      loop
      muted
      class="absolute h-full w-full object-cover transition-transform duration-1000 hover:scale-105"
      transition:name={slug}
    />
  ) : (
    <Image
      width={width}
      height={height}
      {/* IMPORTANT: Do not remove transition:name - enables zoom animations between pages */}
      transition:name={slug}
      loading={typeof index !== "undefined" && index <= 5 ? "eager" : "lazy"}
      src={finalImageURL}
      alt="Cover image"
      class="absolute h-full w-full object-cover transition-transform duration-1000 hover:scale-105"
    />
  )}
</div>
