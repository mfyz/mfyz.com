---
title: "WordPress'ten MDX (Astro) AktarÄ±m Script'i"
description: "WordPress blog yazÄ±larÄ±nÄ± Astro MDX formatÄ±na aktarmak iÃ§in yazdÄ±ÄŸÄ±m Node.js script'inin detaylarÄ±, frontmatter oluÅŸturma ve iÃ§erik dÃ¶nÃ¼ÅŸtÃ¼rme sÃ¼reÃ§leri."
slug: wordpress-mdx-astro-migration-scripti
date: "2025-06-24"
tags:
  - web development
  - astro
  - wordpress
  - nodejs
  - migration
---

import ImageZoom from "@components/ImageZoom.astro";
import Note from "@components/Note.astro";

[Ã–nceki yazÄ±mda](/blogumu-wordpress-ten-astroya-tasidim) WordPress'ten Astro'ya geÃ§iÅŸ yolculuÄŸumu paylaÅŸmÄ±ÅŸtÄ±m. O yazÄ±da bahsettiÄŸim gibi, sÃ¼recin en kritik kÄ±sÄ±mlarÄ±ndan biri WordPress'teki iÃ§erikleri Astro ile uyumlu MDX formatÄ±na taÅŸÄ±maktÄ± - ki bu gerÃ§ekten de keyifli bir sÃ¼rece dÃ¶nÃ¼ÅŸtÃ¼!

Bu yazÄ±da, WordPress veritabanÄ±mdaki yazÄ±larÄ± dÃ¼zgÃ¼n formatlanmÄ±ÅŸ MDX dosyalarÄ±na dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in kullandÄ±ÄŸÄ±m script'i paylaÅŸÄ±yorum. Bu script doÄŸrudan WordPress veritabanÄ±nÄ±za baÄŸlanÄ±yor, yazÄ±larÄ± Ã§ekiyor ve uygun frontmatter ile MDX formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼rÃ¼yor.

## ğŸ¤” Genel TaÅŸÄ±nma ZorluklarÄ±

WordPress'ten Astro gibi bir statik site Ã¼reticisine taÅŸÄ±mada en zorlu kÄ±sÄ±m, WordPress veritabanÄ±nda saklanan farklÄ± tÃ¼rdeki iÃ§erik yapÄ±larÄ±nÄ± Ã§evirmek. Wordpress, yazilarinizi, HTML formatÄ±nda saklÄ±yor ama birÃ§ok plugin kendi meta data'sÄ±nÄ± saklayabiliyor. Ã‡oÄŸunlukla shortcode olabiliyor, veya serialize edilmis data saklanabiliyor. Genelde JSON formatinda, ama her zaman deÄŸil. ÅanslÄ±ydÄ±m ki, onceki Wordpress blogumda sadece bir plugin kullaniyordum ve o da LD+JSON meta data saklÄ±yordu, onu da feda ettim ve Astro versiyonunda ihtiyacÄ±m yok diyebildim. Ama sizin daha karmaÅŸÄ±k iÃ§erik elementleriniz olabilir ki bunlarÄ± markdown'a ya da front-matter Ã¶zelliklerine Ã§evirmek zorlayÄ±cÄ± olabilir. DiÄŸer genel zorluklar:

- Medya referanslarÄ± ve URL yollari
- Etiketler ve kategoriler
- Ã–zel karakterler ve biÃ§imlendirme

TaÅŸÄ±ma sÃ¼reci Ã¼zerinde tam kontrol sahibi olabilecek bir script'e ihtiyacÄ±m vardÄ±. Ã‡eÅŸitli araÃ§lara baktÄ±ktan sonra, doÄŸrudan WordPress veritabanÄ±ma eriÅŸecek ve yazÄ±larÄ± tam istediÄŸim ÅŸekilde Ã§Ä±karacak kendi script'imi yazmaya karar verdim. Bunu da zaten AI Editor ile hizlica yapabildim.

ğŸ’¡ **Ä°pucu:** VeritabanÄ±mÄ± dÄ±ÅŸa aktarÄ±p (export) yerel'de Ã§alÄ±ÅŸtÄ±rdÄ±m bu scripti ve localhost'daki MySQL veritabanÄ±na baÄŸlandÄ±m. Bu sayede, script 1000 yazÄ±yÄ± 10 saniyeden az sÃ¼rede dÃ¶nÃ¼ÅŸtÃ¼rebildi. Bu sayede sorunlarÄ± Ã§Ã¶zÃ¼p, ince ayar yapÄ±p, hÄ±zlÄ±ca tekrar tekrar Ã§alÄ±ÅŸtÄ±rabildim.

## ğŸ“‹ Ã–nce ve Sonra

Ne yapmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±mÄ±za bakalÄ±m:

**Ã–nce:** MySQL veritabanÄ±nda saklanan bir WordPress yazÄ±sÄ± - HTML iÃ§erik, ayrÄ± tablolarda metadata ve WordPress'in yÃ¼kleme dizininden referans edilen medya.

**Sonra:** Temiz bir MDX dosyasÄ±:

- YapÄ±landÄ±rÄ±lmÄ±ÅŸ frontmatter (title, slug, date, tags vs.)
- HTML'den Markdown'a dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ iÃ§erik
- Yerel referanslara gÃ¼ncellenmiÅŸ resim yollarÄ±
- DÃ¼zgÃ¼n formatlanmÄ±ÅŸ kod bloklarÄ±
- DoÄŸru iÅŸlenmiÅŸ Ã¶zel karakterler

## ğŸ› ï¸ AktarÄ±m Script'i

Script, WordPress veritabanÄ±nÄ±za baÄŸlanmak, yazÄ±larÄ± Ã§ekmek ve yÄ±la gÃ¶re organize edilmiÅŸ MDX dosyalarÄ±na dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in Node.js kullanÄ±yor. Ä°htiyacÄ±nÄ±z olanlar:

```sh
npm install dotenv mysql2 turndown slugify
```

DetaylÄ± aÃ§Ä±klamalarla birlikte tam script:

````js
require("dotenv").config();
const fs = require("fs/promises");
const path = require("path");
const mysql = require("mysql2/promise");
const TurndownService = require("turndown");
const he = require("he"); // HTML entity decoder for fixing &amp; in titles

const postsDir = path.join(__dirname, "../src/content/blog");

const turndown = new TurndownService({
  codeBlockStyle: "fenced",
  escapeCodeBlock: false,
  headingStyle: "atx", // Bu # sembollerini kullanacak baÅŸlÄ±klar iÃ§in
});

// WordPress resim URL'lerini yerel yollarla deÄŸiÅŸtiren fonksiyon
function replaceImageUrls(content) {
  // Sadece CDN prefix'ini deÄŸiÅŸtir, diÄŸer her ÅŸeyi olduÄŸu gibi bÄ±rak
  let processedContent = content.replace(
    /https?:\/\/i[0-9]\.wp\.com\/mfyz\.com\//g,
    "https://mfyz.com/"
  );

  // Normal URL'leri yerel yol formatÄ±na Ã§evir
  return processedContent.replace(
    /https?:\/\/(?:www\.)?mfyz\.(?:com|wp)\/wp-content\/uploads\/([0-9]{4})\/([0-9]{2})\/([^"\s)]+)/g,
    (match, year, month, filename) =>
      `/images/archive/en/${year}/${month}/${filename}`
  );
}

// Paragraf aralarÄ± iÃ§in Ã¶zel kural ekle
turndown.addRule("paragraphBreak", {
  filter: function (node) {
    return (
      node.nodeName === "P" &&
      node.getAttribute("data-paragraph-break") !== null
    );
  },
  replacement: function () {
    return "\n\n";
  },
});

// Kod bloklarÄ±nÄ± Ã¼Ã§lÃ¼ backtick kullanacak ÅŸekilde ayarla
turndown.addRule("pre", {
  filter: "pre",
  replacement: function (content) {
    return "\n```\n" + content + "\n```\n";
  },
});

async function connectToDatabase() {
  return await mysql.createConnection({
    host: process.env.DB_HOST,
    port: process.env.DB_PORT || 3306,
    user: process.env.DB_USER,
    password: process.env.DB_PASS,
    database: process.env.DB_NAME,
  });
}

async function getPosts(connection) {
  const [rows] = await connection.execute(`
        SELECT 
            p.ID,
            p.post_title, 
            p.post_content,
            p.post_date,
            p.post_name,
            p.guid,
            GROUP_CONCAT(DISTINCT t.name) as tags,
            GROUP_CONCAT(DISTINCT c.name) as categories
        FROM ${process.env.WP_TABLE_PREFIX}posts p
        LEFT JOIN ${process.env.WP_TABLE_PREFIX}term_relationships tr ON p.ID = tr.object_id
        LEFT JOIN ${process.env.WP_TABLE_PREFIX}term_taxonomy tt ON tr.term_taxonomy_id = tt.term_taxonomy_id
        LEFT JOIN ${process.env.WP_TABLE_PREFIX}terms t ON tt.term_id = t.term_id
        LEFT JOIN ${process.env.WP_TABLE_PREFIX}terms c ON (tt.taxonomy = 'category' AND tt.term_id = c.term_id)
        WHERE p.post_status = 'publish' AND p.post_type = 'post'
        GROUP BY p.ID
    `);
  return rows;
}

async function processPost(post) {
  const date = new Date(post.post_date);
  const year = date.getFullYear();
  const formattedDate = date.toISOString().split("T")[0];
  const fileName = `${formattedDate}-${post.post_name}.mdx`;

  // YÄ±lÄ± hem dizin hem de dosya adÄ±nÄ±n parÃ§asÄ± olarak kullan
  const yearFolder = year.toString();

  // BaÅŸlÄ±ktaki HTML entity'leri Ã§Ã¶z (&amp; -> & gibi)
  const decodedTitle = post.post_title
    .replace(/&amp;/g, "&")
    .replace(/&lt;/g, "<")
    .replace(/&gt;/g, ">")
    .replace(/&quot;/g, '"');

  const frontMatter = {
    title: decodedTitle,
    slug: post.post_name,
    date: date.toISOString().substring(0, 10),
    url: post.guid.replace("mfyz.wp", "mfyz.com"),
    tags: post.tags ? post.tags.split(",") : [],
    category: post.categories ? post.categories.split(",")[0] : "",
    migration: {
      wpId: post.ID,
      wpPostDate: post.post_date,
    },
  };

  // HTML'de paragraf aralarÄ±nÄ± daha iyi tanÄ±mlayÄ±p korumak iÃ§in Ã¶n iÅŸleme
  // Bu, HTML'deki Ã§ift satÄ±r sonlarÄ±nÄ± (paragraf aralarÄ±nÄ± gÃ¶sterir) tanÄ±mlayarak
  // ve onlarÄ± turndown boyunca korunacak Ã¶zel iÅŸaretleyici ile iÅŸaretleyerek Ã§alÄ±ÅŸÄ±r
  let preprocessedHtml = post.post_content
    // Ã–nce tÃ¼m satÄ±r sonlarÄ±nÄ± normalize et
    .replace(/\r\n|\r/g, "\n")
    // Paragraf aralarÄ±nÄ± Ã¶zel token ile iÅŸaretle
    .replace(/\n\n+/g, "\n\n<p data-paragraph-break></p>\n\n");

  // HTML'i Markdown'a Ã§evir
  let content = turndown.turndown(preprocessedHtml);

  // Markdown'Ä± son iÅŸlemden geÃ§irerek dÃ¼zgÃ¼n paragraf aralÄ±ÄŸÄ±nÄ± geri yÃ¼kle
  content = content
    // Paragraf arasÄ± iÅŸaretleyicilerimizi Ã§ift satÄ±r sonu ile deÄŸiÅŸtir
    .replace(/\n*<p data-paragraph-break><\/p>\n*/g, "\n\n");

  // Sorun dÃ¼zeltme: Markdown iÃ§erikten gereksiz ters eÄŸik Ã§izgi kaÃ§Ä±ÅŸlarÄ±nÄ± kaldÄ±r
  // Bu, normal metinde kaÃ§Ä±rÄ±lmamasÄ± gereken yaygÄ±n karakterleri iÅŸler
  content = content
    // KaÃ§Ä±rÄ±lmÄ±ÅŸ alt Ã§izgileri dÃ¼zelt (kod referanslarÄ±nda yaygÄ±n)
    .replace(/\\(_)/g, "$1")
    // KaÃ§Ä±rÄ±lmÄ±ÅŸ yÄ±ldÄ±zlarÄ± dÃ¼zelt
    .replace(/\\(\*)/g, "$1")
    // KaÃ§Ä±rÄ±lmÄ±ÅŸ kÃ¶ÅŸeli parantezleri dÃ¼zelt
    .replace(/\\(\[|\])/g, "$1")
    // GerÃ§ek kaÃ§Ä±ÅŸ dizilerinin parÃ§asÄ± olmayan kaÃ§Ä±rÄ±lmÄ±ÅŸ ters eÄŸik Ã§izgileri dÃ¼zelt
    .replace(/\\(\\)([^\w])/g, "$1$2");

  // Kod bloklarÄ± iÃ§in ekstra adÄ±m: Kod iÃ§eriÄŸinin kaÃ§Ä±rÄ±lmadÄ±ÄŸÄ±ndan emin ol
  content = content.replace(
    /```[^\n]*\n([\s\S]*?)\n```/g,
    function (match, codeContent) {
      // Kod bloklarÄ±ndaki karakterleri kaÃ§Ä±ÅŸtan Ã§Ä±kar
      return match.replace(
        codeContent,
        codeContent
          .replace(/\\(_)/g, "$1")
          .replace(/\\(\*)/g, "$1")
          .replace(/\\(\[|\])/g, "$1")
          .replace(/\\(\\)/g, "$1")
      );
    }
  );

  // WordPress resim URL'lerini yerel yollarla deÄŸiÅŸtir
  content = replaceImageUrls(content);
  return {
    year: yearFolder,
    fileName: fileName,
    content: `---
${Object.entries(frontMatter)
  .map(([k, v]) => {
    if (k === "title") {
      // Ã‡ift tÄ±rnak iÃ§eren baÅŸlÄ±klar iÃ§in tek tÄ±rnak kullan
      return v.includes('"') ? `${k}: '${v}'` : `${k}: "${v}"`;
    } else {
      return `${k}: ${typeof v === "object" ? JSON.stringify(v) : v}`;
    }
  })
  .join("\n")}
---

import Image from "@components/Image.astro";

${content}`,
  };
}

async function main() {
  try {
    const connection = await connectToDatabase();
    const posts = await getPosts(connection);
    console.log(`Ä°ÅŸlenecek ${posts.length} yazÄ± bulundu`);

    await fs.mkdir(postsDir, { recursive: true });

    for (const [index, post] of posts.entries()) {
      console.log(`Ä°ÅŸleniyor ${index + 1}/${posts.length}: ${post.post_title}`);
      const { year, fileName, content } = await processPost(post);

      // YÄ±l dizini yoksa oluÅŸtur
      const yearDir = path.join(postsDir, year);
      await fs.mkdir(yearDir, { recursive: true });

      // DosyayÄ± yÄ±l dizinine yaz
      await fs.writeFile(path.join(yearDir, fileName), content);
    }

    await connection.end();

    console.log("DÄ±ÅŸa aktarÄ±m baÅŸarÄ±yla tamamlandÄ±!");
  } catch (error) {
    console.error("DÄ±ÅŸa aktarÄ±m baÅŸarÄ±sÄ±z:", error);
    process.exit(1);
  }
}

main();
````

## âš™ï¸ Ortam Degiskenleri ve Ayarlar

WordPress veritabanÄ± bilgilerinizle bir `.env` dosyasÄ± oluÅŸturmanÄ±z gerekecek:

```
DB_HOST=localhost
DB_PORT=3306
DB_USER=your_db_user
DB_PASS=your_db_password
DB_NAME=your_wordpress_db
WP_TABLE_PREFIX=wp_
```

<Note>
  Script'teki hedef dizini Astro proje yapÄ±nÄ±za uyacak ÅŸekilde gÃ¼ncellemeyi
  unutmayÄ±n. VarsayÄ±lan olarak dosyalarÄ± script konumuna gÃ¶re
  `../src/content/blog/YYYY/` iÃ§ine koyuyor.
</Note>

## ğŸŒŸ Script'in Temel Ã–zellikleri

Script sadece basit bir dÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ deÄŸil - yaygÄ±n WordPress'ten Markdown aktarÄ±m sorunlarÄ±nÄ± Ã§Ã¶zmek iÃ§in birkaÃ§ Ã¶zellik iÃ§eriyor:

1. **HTML'den Markdown dÃ¶nÃ¼ÅŸÃ¼mÃ¼**: Turndown kullanarak WordPress HTML'ini temiz Markdown'a Ã§eviriyor
2. **AkÄ±llÄ± frontmatter oluÅŸturma**: Astro iÃ§in gerekli tÃ¼m alanlarÄ± iÃ§eren yapÄ±landÄ±rÄ±lmÄ±ÅŸ frontmatter oluÅŸturuyor
3. **Resim yolu yeniden yazma**: WordPress medya URL'lerini yerel dosya yollarÄ±na Ã§eviriyor
4. **Paragraf aralÄ±ÄŸÄ± koruma**: Paragraflar arasÄ± dÃ¼zgÃ¼n aralÄ±ÄŸÄ± koruyor
5. **Markdown kaÃ§Ä±ÅŸ dÃ¼zeltme**: Karakterlerin gereksiz kaÃ§Ä±ÅŸlarÄ±nÄ± kaldÄ±rÄ±yor
6. **YÄ±l bazlÄ± organizasyon**: YazÄ±larÄ± yÄ±la gÃ¶re dÃ¼zenliyor, Astro iÃ§erik yapÄ±ma uygun
7. **Ã–zel karakter iÅŸleme**: BaÅŸlÄ±klardaki HTML entity'leri dÃ¼zgÃ¼n Ã§Ã¶zÃ¼yor

## ğŸ¨ Script'i Kendi Ä°htiyacÄ±nÄ±za GÃ¶re DÃ¼zenleyebilirsiniz

Bu script benim ihtiyaÃ§larÄ±m iÃ§in mÃ¼kemmel Ã§alÄ±ÅŸsa da, siz kendi WordPress kurulumunuz iÃ§in dÃ¼zenlemek isteyebilirsiniz:

- **Ä°Ã§erik dizinini deÄŸiÅŸtirin**: `postsDir` deÄŸiÅŸkenini Astro iÃ§erik konumunuza uyacak ÅŸekilde gÃ¼ncelleyin
- **Frontmatter'Ä± deÄŸiÅŸtirin**: `frontMatter` nesnesine alan ekleyin ya da Ã§Ä±karÄ±n
- **Resim yollarÄ±nÄ± ayarlayÄ±n**: `replaceImageUrls` fonksiyonunu istediÄŸiniz resim yolu formatÄ±na uyacak ÅŸekilde gÃ¼ncelleyin
- **Ek iÃ§erik iÅŸleme ekleyin**: Ä°Ã§eriÄŸinizin ihtiyaÃ§ duyabileceÄŸi diÄŸer dÃ¶nÃ¼ÅŸÃ¼mleri ekleyin

## ğŸ–¼ï¸ Resimler ve Medya

Ben wp-content dizinimi manuel olarak Astro public dizinine kopyaladÄ±m (`/public/images/archive` gibi), script'te de yollarÄ± `/wp-content/uploads/`'dan `/images/archive/`'a gÃ¼ncelleyen bir bÃ¶lÃ¼m var.

## ğŸš€ Yayina Girmeden Once

Script'i Ã§alÄ±ÅŸtÄ±rÄ±p iÃ§eriÄŸinizin iyi gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nÃ¼ doÄŸruladÄ±ktan sonra, yayina almadan once, ÅŸu adÄ±mlarÄ± izleyin:

1. DÄ±ÅŸa aktarÄ±lan MDX dosyalarÄ±ndan bir Ã¶rneÄŸi gÃ¶zden geÃ§irin, iÃ§erik ve biÃ§imlendirmenin doÄŸru olduÄŸundan emin olun. Hatta tum icerikleri tek tek kontrol etmeniz da iyi olabilir.
2. Resim yollarÄ±nÄ± kontrol edin ve tÃ¼m medyanÄ±n dÃ¼zgÃ¼n referans edildiÄŸinden emin olun
3. YayÄ±na almadan Ã¶nce sorunlarÄ± yakalamak iÃ§in Astro sitenizi yerel'de Ã§alÄ±ÅŸtÄ±rÄ±n
4. URL yapÄ±nÄ±z deÄŸiÅŸtiyse eski WordPress URL'leriniz iÃ§in yÃ¶nlendirmeler kurun

## ğŸ¯ SÄ±rada Ne Var?

Ä°Ã§eriÄŸinizi baÅŸarÄ±yla aktardÄ±ktan sonra, yeni Astro sitenizin Ã¶zelliklerini ve tasarÄ±mÄ±nÄ± geliÅŸtirmeye odaklanabilirsiniz. Benim deneyimimde, temiz iÃ§eriÄŸe sahip olmak bu sÃ¼reci Ã§ok daha keyifli hale getiriyor, Ã§Ã¼nkÃ¼ baÅŸtan dÃ¼zgÃ¼n yapÄ±landÄ±rÄ±lmÄ±ÅŸ veriyle Ã§alÄ±ÅŸÄ±yorsunuz.

AktarÄ±m, Astro site stillerimi ve biÃ§imlendirmelerimi ince ayar yapÄ±p geliÅŸtirmeden Ã¶nce yaptÄ±ÄŸÄ±m ilk ÅŸeydi. Tam iÃ§erik arÅŸivim yerinde olduktan sonra, onlarÄ± eski WordPress siteme kÄ±yasla daha da iyi gÃ¶rÃ¼nÃ¼r ve cilalÄ± hale getirmek gerÃ§ekten Ã§ok eÄŸlenceliydi.

Ben 2 tarayÄ±cÄ±yÄ± yan yana aÃ§tÄ±m ve her yazÄ±yÄ±, canlÄ± versiyonu ve astro/yerel'i karÅŸÄ±laÅŸtÄ±rarak en azÄ±ndan iÃ§erik perspektifinden benzer gÃ¶rÃ¼ndÃ¼klerinden emin oldum, stil aynÄ± olmasa bile.
